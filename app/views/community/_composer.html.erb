<section class="rounded-2xl border border-gray-200 bg-white p-5 shadow-sm">
  <div class="flex flex-wrap items-start justify-between gap-4">
    <div>
      <p class="text-xs font-semibold uppercase tracking-widest text-rose-500">Share a quick win</p>
      <h2 class="mt-1 text-lg font-semibold text-gray-900">Post to the feed in real time</h2>
      <p class="mt-1 text-sm text-gray-600">
        Start a conversation and everyone connected to the community tab will see it instantly.
      </p>
    </div>
    <div class="rounded-full bg-rose-50 px-3 py-1 text-xs font-semibold text-rose-600">
      Drafts auto-save for 10 minutes
    </div>
  </div>

  <%= form_with url: community_discussions_path,
                scope: :discussion,
                data: {
                  controller: "community-composer",
                  turbo_stream: true,
                  action: "turbo:submit-end->community-composer#handleSubmitEnd"
                },
                class: "mt-6 space-y-4" do |form| %>
    <div class="grid gap-4 lg:grid-cols-[minmax(0,1fr)_200px]">
      <div class="space-y-4">
        <div>
          <%= form.label :title, "Headline", class: "text-xs font-semibold uppercase tracking-widest text-gray-500" %>
          <%= form.text_field :title,
                              required: true,
                              placeholder: "What are you shipping or exploring?",
                              class: "mt-1 w-full rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm transition focus:border-rose-400 focus:outline-none focus:ring-1 focus:ring-rose-400",
                              data: { community_composer_target: "title" } %>
        </div>

        <div>
          <%= form.label :summary, "What's the context?", class: "text-xs font-semibold uppercase tracking-widest text-gray-500" %>
          <%= form.text_area :summary,
                             required: true,
                             rows: 3,
                             placeholder: "Add a few sentences so others can lean in with feedback.",
                             class: "mt-1 w-full rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm transition focus:border-rose-400 focus:outline-none focus:ring-1 focus:ring-rose-400",
                             data: { community_composer_target: "summary" } %>
        </div>
      </div>

      <div class="space-y-4">
        <div>
          <%= form.label :topics, "Tag it", class: "text-xs font-semibold uppercase tracking-widest text-gray-500" %>
          <%= form.select :topics,
                          communities.map { |community| [community[:name], community[:key]] },
                          { selected: topic, include_blank: "Choose a topic" },
                          class: "mt-1 w-full rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm transition focus:border-rose-400 focus:outline-none focus:ring-1 focus:ring-rose-400" %>
        </div>

        <div>
          <%= form.label :author_role, "Role (optional)", class: "text-xs font-semibold uppercase tracking-widest text-gray-500" %>
          <%= form.text_field :author_role,
                              placeholder: "e.g. Product Engineer",
                              class: "mt-1 w-full rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm transition focus:border-rose-400 focus:outline-none focus:ring-1 focus:ring-rose-400" %>
        </div>
      </div>
    </div>

    <div class="flex flex-wrap items-center justify-between gap-3 border-t border-gray-100 pt-4">
      <div class="flex items-center gap-2 text-xs text-gray-500">
        <span class="inline-flex size-2 rounded-full bg-emerald-500"></span>
        Posts go live instantly via Turbo Streams.
      </div>
      <div class="flex items-center gap-3">
        <button type="reset"
                class="text-sm font-medium text-gray-500 transition hover:text-rose-600"
                data-action="community-composer#resetDraft">
          Clear draft
        </button>
        <%= form.button "Share update",
                        class: "inline-flex items-center gap-2 rounded-full bg-rose-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-rose-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-500 focus-visible:ring-offset-2" %>
      </div>
    </div>
  <% end %>
</section>

